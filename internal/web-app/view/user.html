<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>用户管理 - 系统</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Nunito:wght@600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/static/css/user.css">
    <!-- 替换 Bootstrap Icons CDN -->
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/bootstrap-icons/1.11.3/font/bootstrap-icons.css">
    <!-- 替换 Particles.js CDN -->
    <script src="https://unpkg.com/particles.js@2.0.0/particles.min.js"></script>
</head>
<body>
<div id="particles-js"></div>

<nav class="navbar-tech">  <!-- 导航栏容器，class="navbar-tech"是自定义样式（让导航栏好看） -->
    <div class="container d-flex justify-content-between align-items-center">  <!-- 容器：用Bootstrap的flex布局，让内容左右对齐、垂直居中 -->
        <div class="d-flex align-items-center">  <!-- 左侧内容：flex布局让元素横向排列 -->
            <a href="/" class="me-4 text-dark">  <!-- 链接：点击跳回主页（/是首页路径）；me-4是右边距，text-dark是文字黑色 -->
                <i class="bi bi-arrow-left-circle me-1"></i>返回主页  <!-- 图标：bi-arrow-left-circle是返回箭头图标，me-1是图标和文字的间距 -->
            </a>
            <h3 class="navbar-title">用户管理</h3>  <!-- 页面标题：显示“用户管理” -->
        </div>

        <div class="d-flex align-items-center">  <!-- 右侧内容：flex布局横向排列 -->
            <span class="user-info text-dark me-4">  <!-- 显示用户信息，me-4是右边距 -->
                    <i class="bi bi-person-circle me-1"></i>{{.Username}}  <!-- 图标：用户头像图标；{{.Username}}是后端传的用户名（如“张三”） -->
                    {{if .IsAdmin}}<span class="admin-badge">管理员</span>{{end}}  <!-- 条件判断：如果是管理员（后端传的.IsAdmin为true），显示“管理员”徽章 -->
                </span>
            <a href="/logout" class="logout-btn">  <!-- 退出登录链接：点击跳转到/logout路径（后端处理退出） -->
                <i class="bi bi-power text-danger me-1"></i>退出  <!-- 图标：电源图标，text-danger是红色 -->
            </a>
        </div>
    </div>
</nav>

<div class="table-container">
    <table class="table-glass table-hover">  <!-- 表格：table-glass是自定义半透明样式；table-hover是鼠标移到行上会变色 -->
        <thead>  <!-- 表格头部（标题行） -->
        <tr>  <!-- 行 -->
            <th>ID</th>  <!-- 列标题：用户ID -->
            <th>用户名</th>  <!-- 列标题：用户名 -->
            <th>角色</th>  <!-- 列标题：用户角色（管理员/普通用户） -->
            <th>注册时间</th>  <!-- 列标题：注册时间 -->
            {{if .IsAdmin}}<th>操作</th>{{end}}  <!-- 条件：管理员多一列“操作”（编辑/删除） -->
        </tr>
        </thead>

        <tbody>  <!-- 表格内容（数据行） -->
        {{range .Users}}  <!-- 循环渲染：后端传的.Users是用户列表，遍历每个用户 -->
        <tr class="table-row-hover">  <!-- 表格行，鼠标移上去有样式变化 -->
            <td>{{.ID}}</td>  <!-- 显示用户ID（后端每个用户的.ID） -->
            <td>{{.Username}}</td>  <!-- 显示用户名（后端每个用户的.Username） -->
            <td>  <!-- 显示角色 -->
                {{if .IsAdmin}}  <!-- 条件：如果该用户是管理员 -->
                <span class="badge badge-admin">管理员</span>  <!-- 显示“管理员”徽章（红色或特殊样式） -->
                {{else}}  <!-- 否则是普通用户 -->
                <span class="badge badge-user">普通用户</span>  <!-- 显示“普通用户”徽章（蓝色或普通样式） -->
                {{end}}
            </td>
            <td>{{.RegTime.Format "2006-01-02"}}</td>  <!-- 显示注册时间：后端传的.RegTime是时间，格式化成年-月-日（如2025-07-08） -->

            {{if $.IsAdmin}}  <!-- 条件：只有管理员能看到操作列（$.IsAdmin指的是当前登录用户是否为管理员） -->
            <td>  <!-- 操作列 -->
                <div class="btn-group">  <!-- 按钮组，让按钮并排显示 -->
                    <button class="btn-warning" onclick="openEditModal({{.ID}}, {{.Username}}, {{.IsAdmin}})">  <!-- 点击触发JS函数：打开编辑弹窗，传当前用户的ID、用户名、是否管理员 -->
                    <i class="bi bi-pencil me-1"></i> 编辑  <!-- 图标：铅笔图标 -->
                    <div class="btn-ripple"></div>  <!-- 波纹效果容器 -->
                    </button>
                    <button class="btn-danger" onclick="deleteUser({{.ID}}, {{.Username}})">  <!-- 点击触发JS函数：删除用户，传ID和用户名 -->
                    <i class="bi bi-trash me-1"></i> 删除  <!-- 图标：垃圾桶图标 -->
                    <div class="btn-ripple"></div>  <!-- 波纹效果容器 -->
                    </button>
                </div>
            </td>
            {{end}}  <!-- 结束管理员操作列条件 -->
        </tr>
        {{else}}  <!-- 如果没有用户数据（.Users为空） -->
        <tr>  <!-- 空数据行 -->
            <td colspan="{{if .IsAdmin}}5{{else}}4{{end}}" class="text-center text-secondary">  <!-- 合并列：管理员时合并5列，普通用户合并4列；文字居中、灰色 -->
                暂无用户数据  <!-- 显示提示文字 -->
            </td>
        </tr>
        {{end}}  <!-- 结束用户列表循环 -->
        </tbody>



    </table>

</div>




{{if .IsAdmin}}
<div class="modal fade" id="addUserModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-glow"></div>
            <div class="modal-header">
                <h5 class="modal-title">添加用户</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form id="addForm" onsubmit="return submitAddUser()">
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label">用户名</label>
                        <input type="text" class="form-control" id="addUsername" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">密码</label>
                        <input type="password" class="form-control" id="addPassword" required>
                    </div>
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" id="addIsAdmin">
                        <label class="form-check-label">设为管理员</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="submit" class="btn-primary">
                        保存
                        <div class="btn-ripple"></div>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<div class="modal fade" id="editUserModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-glow"></div>
            <div class="modal-header">
                <h5 class="modal-title">编辑用户</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form id="editForm" onsubmit="return submitEditUser()">
                <input type="hidden" id="editUserId">
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label">用户名</label>
                        <input type="text" class="form-control" id="editUsername" required>
                    </div>
                    <div class="form-check">
                        <input type="checkbox" class="form-check-input" id="editIsAdmin">
                        <label class="form-check-label">设为管理员</label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn-secondary" data-bs-dismiss="modal">取消</button>
                    <button type="submit" class="btn-primary">
                        保存修改
                        <div class="btn-ripple"></div>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{{end}}
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
<script src="/static/js/user.js"></script>
</body>
</html>